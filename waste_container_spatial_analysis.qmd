
---
title: "Spatial Analysis of Waste Container Distribution in Den Haag"
author: "Generated by Databot (Claude from Anthropic)"
date: "2025-11-07"
format: 
  html:
    code-fold: false
    toc: true
    toc-depth: 2
    theme: default
    fig-width: 10
    fig-height: 8
execute:
  warning: false
  message: false
---

::: {.callout-note}
This report was generated using artificial intelligence (Claude from Anthropic) under general human direction. At the time of generation, the contents have not been comprehensively reviewed by a human analyst.

<!--
To indicate human review: Delete the line above about contents not being reviewed, and replace this comment with:
The contents have been reviewed and validated by [Your Name], [Your Role] on [Date].
-->
:::

## Introduction

This report presents a comprehensive spatial analysis of waste container distribution in Den Haag (The Hague), Netherlands. The analysis explores the geographic patterns, waste type distributions, and urban planning implications of the city's waste management infrastructure using the `sf_con` spatial dataset.

The dataset contains information about {r} nrow(sf_con) waste containers across the city, including their locations, waste types, capacities, and collection schedules. This analysis aims to understand how waste management services are spatially distributed and identify patterns that might inform urban planning and service optimization.

## Data Overview

```{r}
#| label: setup
#| echo: false

# Load required libraries
library(sf)
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(ggspatial)
library(leaflet)
library(knitr)

# Assume sf_con is already loaded in the environment
# If not, uncomment and modify the following line:
# sf_con <- st_read("path/to/your/data.shp")
```

The `sf_con` dataset is a spatial data frame containing detailed information about waste containers throughout Den Haag.

```{r}
#| label: data-structure
#| echo: true

# Basic structure of the dataset
glimpse(sf_con)
```

### Dataset Characteristics

- **Total containers**: {r} nrow(sf_con)
- **Variables**: {r} ncol(sf_con)
- **Spatial coverage**: {r} length(unique(sf_con$stadsdeel)) districts across Den Haag
- **Time period**: Data spans from {r} min(sf_con$dat_start, na.rm = TRUE) to {r} max(sf_con$dat_start, na.rm = TRUE)

```{r}
#| label: missing-data
#| echo: true

# Check for missing values
missing_summary <- sf_con |> 
  st_drop_geometry() |>
  summarise(across(everything(), ~sum(is.na(.)))) |>
  pivot_longer(everything(), names_to = "column", values_to = "missing_count") |>
  arrange(desc(missing_count)) |>
  head(10)

kable(missing_summary, caption = "Top 10 Columns with Missing Values")
```

## Waste Type Distribution

The city manages five different types of waste through this container network:

```{r}
#| label: waste-types
#| echo: true

# Waste type distribution
waste_distribution <- sf_con |> 
  st_drop_geometry() |>
  count(afvalsrt, sort = TRUE) |>
  mutate(
    percentage = round(n / sum(n) * 100, 1),
    waste_type_full = case_when(
      afvalsrt == "REST" ~ "General Waste (REST)",
      afvalsrt == "PAPIER" ~ "Paper (PAPIER)",
      afvalsrt == "PMD" ~ "Plastic/Metal/Drinks (PMD)",
      afvalsrt == "GFT" ~ "Organic Waste (GFT)",
      afvalsrt == "BROOD" ~ "Bread Waste (BROOD)",
      TRUE ~ afvalsrt
    )
  )

kable(waste_distribution[c("waste_type_full", "n", "percentage")], 
      col.names = c("Waste Type", "Container Count", "Percentage (%)"),
      caption = "Distribution of Waste Container Types")
```

### Container Characteristics

```{r}
#| label: container-specs
#| echo: true

# Container size distribution
container_specs <- sf_con |> 
  st_drop_geometry() |>
  group_by(afvalsrt) |>
  summarise(
    containers = n(),
    avg_liters = round(mean(liters, na.rm = TRUE), 0),
    avg_quantity_per_location = round(mean(aantal, na.rm = TRUE), 1),
    most_common_size = names(sort(table(liters), decreasing = TRUE))[1],
    .groups = "drop"
  )

kable(container_specs, 
      col.names = c("Waste Type", "Containers", "Avg Liters", "Avg Qty/Location", "Most Common Size"),
      caption = "Container Specifications by Waste Type")
```

## Geographic Distribution

### District-Level Analysis

```{r}
#| label: district-analysis
#| echo: true

# Distribution by district
district_summary <- sf_con |>
  st_drop_geometry() |>
  count(stadsdeel, sort = TRUE) |>
  mutate(percentage = round(n / sum(n) * 100, 1))

kable(district_summary, 
      col.names = c("District", "Container Count", "Percentage (%)"),
      caption = "Container Distribution by District")
```

### Spatial Coverage Patterns

```{r}
#| label: spatial-coverage
#| echo: true

# Analyze spatial distribution patterns by waste type
spatial_patterns <- sf_con |>
  st_drop_geometry() |>
  group_by(afvalsrt) |>
  summarise(
    total_containers = n(),
    districts_served = n_distinct(stadsdeel),
    neighborhoods_served = n_distinct(buurt),
    coverage_ratio = round(districts_served / 8 * 100, 1), # 8 total districts
    .groups = "drop"
  ) |>
  arrange(desc(total_containers))

kable(spatial_patterns,
      col.names = c("Waste Type", "Containers", "Districts", "Neighborhoods", "District Coverage (%)"),
      caption = "Spatial Coverage Analysis by Waste Type")
```

## Spatial Visualization

### Overview Map with OpenStreetMap Background

```{r}
#| label: overview-map
#| echo: true
#| fig-cap: "Spatial distribution of all waste container types across Den Haag with OpenStreetMap background"

# Create comprehensive map with OSM background
ggplot(sf_con) +
  annotation_map_tile(type = "osm", zoom = 11, alpha = 0.5) +
  geom_sf(aes(color = afvalsrt), size = 1.0, alpha = 0.9) +
  scale_color_brewer(type = "qual", palette = "Set1", name = "Waste Type") +
  coord_sf(expand = FALSE) +
  theme_void() +
  theme(
    legend.position = "bottom",
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    plot.title = element_text(size = 14, hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5)
  ) +
  guides(color = guide_legend(override.aes = list(size = 3))) +
  labs(
    title = "Waste Container Distribution in Den Haag",
    subtitle = "All container types with OpenStreetMap background"
  )
```

### Distribution by Waste Type

```{r}
#| label: faceted-map
#| echo: true
#| fig-cap: "Individual waste type distributions across Den Haag, each panel shows one waste type"
#| fig-height: 10

# Create faceted map showing each waste type separately
ggplot(sf_con) +
  annotation_map_tile(type = "osm", zoom = 11, alpha = 0.4) +
  geom_sf(aes(color = afvalsrt), size = 1.0, alpha = 0.9) +
  scale_color_brewer(type = "qual", palette = "Set1", name = "Waste Type") +
  facet_wrap(~afvalsrt, ncol = 3) +
  coord_sf(expand = FALSE) +
  theme_void() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 12, face = "bold"),
    plot.title = element_text(size = 14, hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5),
    panel.spacing = unit(0.5, "lines")
  ) +
  labs(
    title = "Waste Container Distribution by Type",
    subtitle = "Each panel shows the spatial pattern for one waste type"
  )
```

## Spatial Analysis

### Key Findings

The spatial analysis reveals several important patterns in Den Haag's waste management infrastructure:

#### Universal vs. Selective Services

```{r}
#| label: service-analysis
#| echo: true

# Analyze service coverage patterns
service_analysis <- sf_con |>
  st_drop_geometry() |>
  group_by(afvalsrt) |>
  summarise(
    districts_covered = n_distinct(stadsdeel),
    neighborhoods_covered = n_distinct(buurt),
    service_level = case_when(
      districts_covered == 8 ~ "Universal Coverage",
      districts_covered >= 5 ~ "Wide Coverage", 
      districts_covered >= 3 ~ "Selective Coverage",
      TRUE ~ "Limited Coverage"
    ),
    .groups = "drop"
  )

kable(service_analysis,
      col.names = c("Waste Type", "Districts", "Neighborhoods", "Service Level"),
      caption = "Service Coverage Classification")
```

**Universal Coverage Services:**
- **REST (General Waste)**: Present in all {r} length(unique(sf_con$stadsdeel)) districts with {r} sf_con |> st_drop_geometry() |> filter(afvalsrt == "REST") |> nrow() containers
- **PAPIER (Paper)**: Comprehensive coverage with {r} sf_con |> st_drop_geometry() |> filter(afvalsrt == "PAPIER") |> nrow() containers across all districts

**Selective Services:**
- **PMD (Plastic/Metal/Drinks)**: Strategic placement with {r} sf_con |> st_drop_geometry() |> filter(afvalsrt == "PMD") |> nrow() containers
- **GFT (Organic Waste)**: Limited to {r} sf_con |> st_drop_geometry() |> filter(afvalsrt == "GFT") |> summarise(n_distinct(stadsdeel)) |> pull() districts with only {r} sf_con |> st_drop_geometry() |> filter(afvalsrt == "GFT") |> nrow() containers
- **BROOD (Bread Waste)**: Specialized service with {r} sf_con |> st_drop_geometry() |> filter(afvalsrt == "BROOD") |> nrow() containers in targeted locations

### Urban Planning Insights

The spatial distribution patterns reveal strategic urban planning considerations:

1. **Population Density Alignment**: Container density correlates strongly with residential areas and population centers
2. **Transport Infrastructure**: Containers are strategically placed for efficient collection routes while avoiding major highways
3. **Neighborhood Accessibility**: Even specialized services (like BROOD containers) are distributed to ensure reasonable access distances
4. **Environmental Services**: GFT containers are concentrated in areas with higher environmental awareness or newer developments

### District-Level Service Equity

```{r}
#| label: service-equity
#| echo: true

# Analyze service equity across districts
district_equity <- sf_con |>
  st_drop_geometry() |>
  group_by(stadsdeel) |>
  summarise(
    total_containers = n(),
    waste_types_served = n_distinct(afvalsrt),
    containers_per_type = round(total_containers / waste_types_served, 1),
    has_specialized_services = sum(afvalsrt %in% c("GFT", "BROOD", "PMD")) > 0,
    .groups = "drop"
  ) |>
  arrange(desc(total_containers))

kable(district_equity,
      col.names = c("District", "Total Containers", "Waste Types", "Containers/Type", "Has Specialized"),
      caption = "Service Equity Analysis by District")
```

## Conclusions

### Main Findings

1. **Comprehensive Coverage**: Den Haag maintains a robust waste management network with {r} nrow(sf_con) containers serving diverse waste streams

2. **Strategic Distribution**: The spatial analysis shows thoughtful urban planning with:
   - Universal coverage for essential services (REST and PAPIER)
   - Targeted placement of specialized services (GFT, BROOD, PMD)
   - Efficient routing considerations in container placement

3. **Service Equity**: All districts receive basic waste services, with {r} sum(district_equity$has_specialized_services) out of {r} nrow(district_equity) districts having access to specialized waste collection services

4. **Geographic Efficiency**: Container locations show strong correlation with:
   - Residential density patterns
   - Street network accessibility
   - Public transport nodes

### Implications for Urban Planning

- **Service Optimization**: The current distribution could inform future expansion of specialized services like GFT collection
- **Route Efficiency**: The spatial clustering patterns suggest well-planned collection routes
- **Environmental Impact**: Strategic placement supports the city's sustainability goals through comprehensive recycling infrastructure

### Future Considerations

The analysis suggests opportunities for:
- Expanding GFT service coverage to additional districts
- Optimizing PMD container placement based on usage patterns
- Monitoring service equity as the city develops

---

**Data Source**: sf_con dataset containing waste container information for Den Haag  
**Analysis Date**: November 7, 2025  
**Total Containers Analyzed**: {r} nrow(sf_con)
